webpackJsonp([2],{BepB:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i("gyMJ"),a=i("T452"),l=i("0xDb"),o={name:"addUser",props:{visible:{type:Boolean,default:!1},groupId:{type:[String,Number],default:""}},data:function(){return{adminId:Object(l.d)(),adminToken:Object(l.f)(),action:a.a.baseURL+"activityExcelUserImport",newUser:"",fileName:"",userListFile:"",userList:[],centerDialogVisible:!1,minute:"",downloadUrl:""}},watch:{visible:function(e){this.newUser="",this.fileName="",this.userList=[],this.userListFile=""}},methods:{save:function(){var e=this;if(this.userList.length){var t=[];this.userList.forEach(function(e){e.mark||t.push(e.mobile)}),s.a.post("traderActivityUserInsertMore",{mobile:t,activityUserGroupId:this.groupId}).then(function(t){e.$emit("update:visible",!1),e.$alert("保存成功",{type:"success"})})}else this.$alert("请添加用户",{type:"error"})},handleAddUserToList:function(){var e=this;s.a.post("activityUserInsertCheck",{mobile:this.newUser,activityUserGroupId:this.groupId}).then(function(t){e.userList.push({mobile:t.data.mobile,mark:t.data.mark})})},handleUploadProgress:function(){this.fileName="上传中..."},handleUploadSuccess:function(e,t,i){0===e.code?(this.fileName=t.name,this.userListFile=e.data):(this.fileName="",e.message&&this.$alert(""+e.message,"上传失败",{type:"error"}))},handleUploadError:function(){this.$alert("上传失败，请重新上传","服务器异常",{type:"error"}),this.fileName=""},exportUserList:function(){var e=this;s.a.post("activityExcelUser").then(function(t){e.minute=t.data.time,e.downloadUrl=t.data.path,e.centerDialogVisible=!0})},handleImport:function(){var e=this;s.a.post("activityUserInsertMoreCheck",{file:this.userListFile,activityUserGroupUuid:this.groupId}).then(function(t){t.data.forEach(function(t){e.userList.length?e.userList.some(function(e){return t.mobile===e.mobile})||e.userList.push(t):e.userList.push(t)})})},handleRemoveUser:function(){this.userList.splice(index,1)}}},r={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-dialog",{attrs:{visible:e.visible,"before-close":function(){e.$emit("update:visible",!1)},width:"800px"},on:{"update:visible":function(t){e.visible=t}}},[i("el-row",{staticClass:"dialog-title",attrs:{slot:"title"},slot:"title"},[i("el-row",{attrs:{type:"flex",align:"middle",justify:"space-between"}},[i("h4",{staticClass:"title"},[e._v("添加用户")]),e._v(" "),i("el-button",{staticClass:"save-button",attrs:{type:"text"},on:{click:e.save}},[e._v("保存")])],1)],1),e._v(" "),i("el-row",{staticClass:"dialog-body"},[i("el-row",{staticClass:"import-content"},[i("el-row",{staticClass:"import-input",attrs:{type:"flex",align:"middle",justify:"center"}},[i("span",[e._v("账号添加：")]),e._v(" "),i("el-col",{attrs:{span:14}},[i("el-input",{attrs:{clearable:"",placeholder:"输入用户彩之云账号"},model:{value:e.newUser,callback:function(t){e.newUser=t},expression:"newUser"}})],1),e._v(" "),i("el-button",{staticClass:"button",attrs:{type:"text"},on:{click:e.handleAddUserToList}},[e._v("添加")])],1),e._v(" "),i("el-row",{staticClass:"import-input",attrs:{type:"flex",align:"middle",justify:"center"}},[i("span",[e._v("批量导入：")]),e._v(" "),i("el-col",{attrs:{span:14}},[i("el-input",{attrs:{placeholder:"",value:e.fileName}})],1),e._v(" "),i("el-upload",{staticClass:"upload-demo",attrs:{accept:".csv",action:e.action+"?adminId="+e.adminId+"&adminToken="+e.adminToken,data:{adminId:e.adminId,adminToken:e.adminToken,fileName:"file"},"show-file-list":!1,"on-progress":e.handleUploadProgress,"on-success":e.handleUploadSuccess,"on-error":e.handleUploadError}},[i("el-button",{staticClass:"button",attrs:{type:"text"}},[e._v("添加")])],1)],1),e._v(" "),i("el-row",{attrs:{type:"flex",align:"middle",justify:"center"}},[i("el-button",{attrs:{type:"primary",plain:""},on:{click:e.exportUserList}},[e._v("下载模版")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.handleImport}},[e._v("确认导入")])],1)],1),e._v(" "),i("el-row",{staticClass:"count"},[e._v("\n                共\n                "),i("span",{staticStyle:{color:"#6699FF"}},[e._v(e._s(e.userList.length))]),e._v(" 条\n            ")]),e._v(" "),i("el-row",{staticClass:"export-content"},e._l(e.userList,function(t,s){return i("el-row",{key:t.mobile,staticClass:"export-item",attrs:{type:"flex",align:"middle"}},[i("el-col",{staticClass:"left",attrs:{span:12}},[e._v(e._s(t.mobile))]),e._v(" "),i("el-col",{staticClass:"right",attrs:{span:10}},[t.mark?i("span",{staticClass:"disable"},[e._v(e._s(t.mark))]):i("el-button",{attrs:{type:"text"},on:{click:function(t){e.handleRemoveUser(s)}}},[e._v("删除")])],1)],1)}))],1)],1),e._v(" "),i("copy-dialog",{attrs:{visible:e.centerDialogVisible,time:e.minute,url:e.downloadUrl},on:{"update:visible":function(t){e.centerDialogVisible=t}}})],1)},staticRenderFns:[]};var n={components:{addUser:i("VU/8")(o,r,!1,function(e){i("rpI9")},"data-v-3bec0287",null).exports},data:function(){this.$createElement;return{list:[],cols:[{label:"ID",prop:"id",align:"center"},{label:"用户头像",prop:"image",align:"center",render:function(e,t){return e("div",[e("div")])}},{label:"用户昵称",prop:"nickname",align:"center"},{label:"用户账号",prop:"mobile",align:"center"},{label:"添加时间",prop:"createAt",align:"center",formatTime:!0},{label:"用户分组",prop:"groups",align:"center"}],actions:[],showAddUser:!1,dialogVisibleGroup:!1,dialogVisibleSelect:!1,selectGroup:"",search:{id:1,keyword:""},keyword:"",totalCount:0,userGroupList:[],addGroupName:"",selectedList:[],minute:"1",downloadUrl:"123",centerDialogVisible:!1}},mounted:function(){this.fetchData(),this.getGroupList(),this.$nextTick(this.renderBreadCrumbAction)},methods:{renderBreadCrumbAction:function(){var e=this;this.$createElement;this.$bus.$emit("changeBreadCrumbAction",function(t,i){return i("div",{},[i("el-button",{attrs:{size:"medium",type:"primary"},on:{click:e.exportExcel}},["导出excel"]),i("el-button",{attrs:{size:"medium",type:"primary"},on:{click:e.addUser}},["添加用户"])])})},exportExcel:function(){var e=this;s.a.post("activityUserDataExcel",{activityUserGroupId:this.search.id}).then(function(t){e.minute=t.data.time,e.downloadUrl=t.data.path,e.centerDialogVisible=!0})},addUser:function(){this.showAddUser=!0},fetchData:function(){var e=this;s.a.post("activityGroupGetWithUsers",this.search).then(function(t){e.list=t.data.users})},doSearch:function(){this.search.keyword=this.keyword,this.search.pageNumber=1,this.search.pageSize=10,this.fetchData()},onPageSize:function(e){this.search.pageSize=e,this.fetchData()},onPageNumber:function(e){this.search.pageNumber=e,this.fetchData()},selection:function(e){this.selectedList=e},handleEditGroup:function(){this.dialogVisibleGroup=!0},handleCancelGroup:function(){this.dialogVisibleGroup=!1,this.addGroupName=""},handleAddGroup:function(){var e=this;this.addGroupName?s.a.post("activityGroupInsert",{title:this.addGroupName}).then(function(t){e.$message({type:"success",message:"添加成功"}),e.dialogVisibleGroup=!1,e.addGroupName="",e.getGroupList()}):this.$message({messsage:"请输入分组名称",type:"error"})},getGroupList:function(){var e=this;s.a.post("activityGroupGetList",{title:""}).then(function(t){e.userGroupList=t.data.dataList})},handleToggleGroup:function(e){this.search.id=e,this.fetchData()},handleGroupingUser:function(){this.selectedList.length?this.dialogVisibleSelect=!0:this.$alert("请选择用户",{type:"error"})},handleGroupUser:function(){var e=this,t=[];this.selectedList.forEach(function(e){t.push(e.mobile)});var i={mobile:t,activityUserGroupId:this.selectGroup};s.a.post("activityGroupUserJoin",i).then(function(t){e.dialogVisibleSelect=!1,e.fetchData()})},handleSelectClose:function(){this.selectGroup=""},handleDeleteUserGroup:function(){var e=this;this.selectedList.length?this.$confirm("此操作将删除该分组关系，是否继续？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var t=[];e.selectedList.forEach(function(e){t.push(e.id)}),s.a.post("activityGroupUserLeave",{id:t}).then(function(t){e.$message({message:"删除成功",type:"success"}),e.fetchData()})}).catch(function(){e.$message({type:"info",message:"已取消删除"})}):this.$alert("请选择用户",{type:"error"})}}},c={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-row",{attrs:{type:"flex"}},[i("el-col",{attrs:{span:20}},[i("div",{staticStyle:{padding:"10px 15px"}},[i("el-button",{on:{click:e.handleGroupingUser}},[e._v("分组")]),e._v(" "),1!=e.search.id?i("el-button",{on:{click:e.handleDeleteUserGroup}},[e._v("删除")]):e._e(),e._v(" "),i("el-input",{staticStyle:{width:"300px","margin-left":"15px"},attrs:{placeholder:"搜索用户账号或昵称","suffix-icon":"el-icon-search"},nativeOn:{keyup:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?e.doSearch(t):null}},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}})],1),e._v(" "),i("div",{staticClass:"flex1"},[i("Utable",{attrs:{data:e.list,cols:e.cols,actions:e.actions,pagination:!1,selection:!0},on:{selection:e.selection}})],1)]),e._v(" "),i("el-col",{staticClass:"user-sidebar",attrs:{span:4}},[e._l(e.userGroupList,function(t){return[1==t.id?i("el-row",{key:t.id,staticClass:"all",class:{active:1===e.search.id},attrs:{type:"flex",align:"middle"},nativeOn:{click:function(t){e.handleToggleGroup(1)}}},[e._v("全部用户（"+e._s(t.userCount)+"）")]):e._e()]}),e._v(" "),i("el-row",{staticClass:"other"},[e._l(e.userGroupList,function(t){return[1!=t.id?i("el-row",{key:t.id,staticClass:"group",class:{active:e.search.id===t.id},attrs:{type:"flex",align:"middle",justify:"center"},nativeOn:{click:function(i){e.handleToggleGroup(t.id)}}},[e._v(e._s(t.title)+"（"+e._s(t.userCount)+"）")]):e._e()]})],2),e._v(" "),i("el-row",{staticClass:"add-button",attrs:{type:"flex",align:"middle",justify:"center"}},[i("el-button",{attrs:{type:"text"},on:{click:e.handleEditGroup}},[e._v("＋新增分组")]),e._v(" "),i("el-dialog",{staticClass:"dialog-group",attrs:{title:"新增分组",visible:e.dialogVisibleGroup,width:"20%"},on:{"update:visible":function(t){e.dialogVisibleGroup=t}}},[i("el-row",{attrs:{type:"flex",align:"middle"}},[i("el-input",{attrs:{placeholder:"请输入分组名称"},model:{value:e.addGroupName,callback:function(t){e.addGroupName=t},expression:"addGroupName"}})],1),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:e.handleCancelGroup}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.handleAddGroup}},[e._v("确 定")])],1)],1)],1)],2)],1),e._v(" "),i("add-user",{attrs:{visible:e.showAddUser,groupId:e.search.id},on:{"update:visible":function(t){e.showAddUser=t}}}),e._v(" "),i("el-dialog",{staticClass:"dialog-group",attrs:{title:"请选择分组",visible:e.dialogVisibleSelect,width:"30%","before-colse":e.handleSelectClose},on:{"update:visible":function(t){e.dialogVisibleSelect=t}}},[i("el-select",{staticClass:"dialog-select",attrs:{placeholder:"请选择"},model:{value:e.selectGroup,callback:function(t){e.selectGroup=t},expression:"selectGroup"}},e._l(e.userGroupList,function(e){return i("el-option",{key:e.id,attrs:{label:e.title,value:e.id}})})),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.dialogVisibleSelect=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.handleGroupUser}},[e._v("确 定")])],1)],1),e._v(" "),i("copy-dialog",{attrs:{visible:e.centerDialogVisible,time:e.minute,url:e.downloadUrl},on:{"update:visible":function(t){e.centerDialogVisible=t}}})],1)},staticRenderFns:[]};var d=i("VU/8")(n,c,!1,function(e){i("vCxN")},"data-v-d8a92960",null);t.default=d.exports},rpI9:function(e,t){},vCxN:function(e,t){}});
//# sourceMappingURL=2.f5b36fef8b22ba5e78a2.js.map