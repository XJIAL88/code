webpackJsonp([9],{KEos:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("gyMJ"),i={name:"timePicker",props:{time:{type:String,default:[]}},data:function(){return{value:["00:00","23:00"]}},watch:{time:function(e){e?(this.$set(this.value,1,e.split("-")[1]),this.$set(this.value,0,e.split("-")[0])):this.value=["00:00","23:00"]}},created:function(){this.time&&(this.$set(this.value,1,this.time.split("-")[1]),this.$set(this.value,0,this.time.split("-")[0]))},methods:{onChange:function(e){e&&(this.time=e,this.$emit("update:time",e.join("-")))}}},l={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-time-picker",{staticStyle:{width:"160px"},attrs:{"is-range":"","range-separator":"-","start-placeholder":"开始时间","end-placeholder":"结束时间","value-format":"HH:mm",format:"HH:mm"},on:{change:e.onChange},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}})],1)},staticRenderFns:[]},n={components:{timePicker:a("VU/8")(i,l,!1,null,null,null).exports},data:function(){return{form:{},prizeList:[],categoryList:[],checkList:[],levelList:[{name:"一等奖",level:"1"},{name:"二等奖",level:"2"},{name:"三等奖",level:"3"},{name:"四等奖",level:"4"},{name:"五等奖",level:"5"}],list:[{name:"一等奖",level:"1",categoryId:"",category:"",activityId:this.$route.query.id,awardId:"",number:"",resourceNumber:"",allDailyNumber:"",personalDailyNumber:"",rate:[""]},{name:"二等奖",level:"2",categoryId:"",category:"",activityId:this.$route.query.id,awardId:"",number:"",resourceNumber:"",allDailyNumber:"",personalDailyNumber:"",rate:[""]},{name:"三等奖",level:"3",categoryId:"",category:"",activityId:this.$route.query.id,awardId:"",number:"",resourceNumber:"",allDailyNumber:"",personalDailyNumber:"",rate:[""]},{name:"四等奖",level:"4",categoryId:"",category:"",activityId:this.$route.query.id,awardId:"",number:"",resourceNumber:"",allDailyNumber:"",personalDailyNumber:"",rate:[""]},{name:"五等奖",level:"5",categoryId:"",category:"",activityId:this.$route.query.id,awardId:"",number:"",resourceNumber:"",allDailyNumber:"",personalDailyNumber:"",rate:[""]}],timeList:[{time:"00:00-23:59"}]}},created:function(){this.getDetail(),this.getPrizeList(),this.$nextTick(this.renderBreadCrumbAction)},methods:{renderBreadCrumbAction:function(){var e=this;this.$createElement;this.$bus.$emit("changeBreadCrumbAction",function(t,a){return a("div",{},[a("el-button",{attrs:{size:"medium",type:"primary"},on:{click:e.submitForm}},["发布"]),a("el-button",{attrs:{size:"medium"},on:{click:e.goBack}},["取消"])])})},getDetail:function(){var e=this;r.a.post("activityGet",{id:this.$route.query.id}).then(function(t){e.form=t.data,t.data.award.length>0&&(e.list=t.data.award,e.timeList=[],t.data.time.forEach(function(t){e.timeList.push({time:t})}),e.levelList=[],t.data.award.forEach(function(t){var a={name:t.name,level:t.level+""};e.levelList.push(a)}),e.checkList=e.form.level.split(","))})},getPrizeList:function(){var e=this,t={search:this.$route.query.number,pageSize:1e3,pageNumber:1};r.a.post("activityAwardGetlist",t).then(function(t){if(t.data.dataList.length>0){e.prizeList=t.data.dataList[0].award,e.categoryList=[];var a=[];t.data.dataList[0].award.forEach(function(t){a.includes(t.categoryId)||(a.push(t.categoryId),e.categoryList.push({categoryId:t.categoryId,categoryName:t.categoryName}))})}})},submitForm:function(){var e=this;if(0!=this.timeList.length)if(0!=this.list.length){var t=[],a=!1;if(this.timeList.forEach(function(r){if(!r.time)return e.showTips("请输入时段"),void(a=!0);t.push(r.time)}),!a&&(this.list.forEach(function(t){var r=e.check(t);if(r)return e.showTips(r),void(a=!0)}),!a)){var i={id:this.$route.query.id,level:this.checkList,time:t,resourceArray:this.list};r.a.post("activityUpdate",i).then(function(t){e.$router.back()})}}else this.showTips("请添加奖品");else this.showTips("请添加时段")},showTips:function(e){this.$alert(e,"提示",{type:"warning",confirmButtonText:"确定",callback:function(e){}})},check:function(e){if(!e.categoryId)return"请选择奖品类型";if(!e.awardId)return"请选择奖品";if(!e.number)return"请输入发放数量";var t="";if(this.prizeList.forEach(function(a){e.awardId==a.id&&(e.resourceNumber=a.resourceNumber,e.number>a.awardNumber&&(t="发放数量不能大于奖品数量"))}),t)return t;var a="";return e.rate.forEach(function(e){e||(a="请输入中奖概率")}),a},goBack:function(){this.$router.back()},changeResource:function(e){this.prizeList.forEach(function(t){t.id==e.awardId&&(e.number=t.awardNumber,e.resourceNumber=t.resourceNumber)})},changeCategory:function(e){e.categoryId&&this.categoryList.forEach(function(t){t.categoryId==e.categoryId&&(e.category=t.categoryName)}),e.awardId=""},addRow:function(){var e=[];this.timeList.forEach(function(t){e.push("")});var t={name:this.formatName(this.list.length+1),level:this.list.length+1+"",categoryId:"",category:"",activityId:this.$route.query.id,awardId:"",number:"",resourceNumber:"",allDailyNumber:"",personalDailyNumber:"",rate:e};this.list.push(t),this.levelList.push({name:this.formatName(this.levelList.length+1),level:this.levelList.length+1+""})},delRow:function(e){this.list.splice(e.$index,1),this.levelList.splice(e.$index,1)},addCol:function(){this.timeList.push({time:""}),this.list.forEach(function(e){e.rate.push("")})},delCol:function(e){this.timeList.splice(e,1),this.list.forEach(function(t){t.rate.splice(e,1)})},formatName:function(e){return this.SectionToChinese(e)+"等奖"},SectionToChinese:function(e){for(var t=["零","一","二","三","四","五","六","七","八","九"],a=["","十","百","千"],r="",i="",l=0,n=!0;e>0;){var o=e%10;0===o?n||(n=!0,i=t[o]+i):(n=!1,r=t[o],i=(r+=a[l])+i),l++,e=Math.floor(e/10)}return i}}},o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"prize-setting"},[a("el-form",{ref:"form",attrs:{model:e.form,"label-width":"100px"}},[a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"活动名称："}},[a("span",[e._v(e._s(e.form.name))])]),e._v(" "),a("el-form-item",{attrs:{label:"活动时间："}},[a("span",[e._v(e._s(e._f("datetime")(e.form.startAt))+"~"+e._s(e._f("datetime")(e.form.endAt)))])]),e._v(" "),a("el-form-item",{attrs:{label:"抽奖次数："}},[a("span",[e._v("每用户共可参加"+e._s(e.form.numberTotal?e.form.numberTotal:"无限")+"次  每用户每天可参加"+e._s(e.form.numberDaily?e.form.numberDaily:"无限")+"次")])]),e._v(" "),a("el-form-item",{attrs:{label:"活动可用奖品："}},[a("span")])],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"活动类型："}},[a("span",[e._v("开门抽奖")])]),e._v(" "),a("el-form-item",{attrs:{label:"新人专享："}},[a("el-switch",{attrs:{disabled:""},model:{value:e.form.new,callback:function(t){e.$set(e.form,"new",t)},expression:"form.new"}}),e._v("（新人：注册30天内的用户）\n                ")],1)],1)],1)],1),e._v(" "),a("el-table",{staticStyle:{width:"721px","margin-left":"20px"},attrs:{data:e.prizeList,border:""}},[a("el-table-column",{attrs:{prop:"categoryName",label:"资源类型",width:"180",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:"奖品名称",width:"180",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"awardNumber",label:"剩余",width:"180",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.awardNumber-t.row.usedNumber))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"usedNumber",label:"已发放",width:"180",align:"center"}})],1),e._v(" "),a("div",{staticStyle:{margin:"20px"}},[e._v("奖品设置：")]),e._v(" "),a("div",{staticStyle:{"margin-left":"20px"}},[a("div",[a("el-checkbox-group",{model:{value:e.checkList,callback:function(t){e.checkList=t},expression:"checkList"}},[e._l(e.levelList,function(t){return a("el-checkbox",{key:t.level,attrs:{label:t.level}},[e._v(e._s(t.name))])}),e._v("--\x3e\n                "),a("label",{staticClass:"el-checkbox"},[e._v("的奖品全部发放完时，活动将自动下线")])],2)],1),e._v(" "),a("div",{staticStyle:{"margin-top":"15px"}},[a("el-table",{attrs:{data:e.list,border:""}},[a("el-table-column",{attrs:{label:"奖品级别",prop:"name",width:"180",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"奖品类型",width:"180",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-select",{attrs:{clearable:"",placeholder:"请选择"},on:{change:function(a){e.changeCategory(t.row)}},model:{value:t.row.categoryId,callback:function(a){e.$set(t.row,"categoryId",a)},expression:"scope.row.categoryId"}},e._l(e.categoryList,function(e){return a("el-option",{key:e.categoryId,attrs:{label:e.categoryName,value:e.categoryId}})}))]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"奖品",width:"180",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-select",{attrs:{clearable:"",placeholder:"请选择"},on:{change:function(a){e.changeResource(t.row)}},model:{value:t.row.awardId,callback:function(a){e.$set(t.row,"awardId",a)},expression:"scope.row.awardId"}},[e._l(e.prizeList,function(r){return[t.row.categoryId==r.categoryId?a("el-option",{key:r.id,attrs:{label:r.name,value:r.id}}):e._e()]})],2)]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"发放数量",width:"180",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{attrs:{placeholder:"不限",type:"number"},model:{value:t.row.number,callback:function(a){e.$set(t.row,"number",a)},expression:"scope.row.number"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"每日上限（数量）",width:"180",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form",{staticClass:"table-form"},[a("el-form-item",{attrs:{label:"全部:","label-width":"55px"}},[a("el-input",{attrs:{placeholder:"不限",type:"number",size:"small"},model:{value:t.row.allDailyNumber,callback:function(a){e.$set(t.row,"allDailyNumber",a)},expression:"scope.row.allDailyNumber"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"每人:","label-width":"55px"}},[a("el-input",{attrs:{placeholder:"不限",type:"number",size:"small"},model:{value:t.row.personalDailyNumber,callback:function(a){e.$set(t.row,"personalDailyNumber",a)},expression:"scope.row.personalDailyNumber"}})],1)],1)]}}])}),e._v(" "),e._l(e.timeList,function(t,r){return[a("el-table-column",{key:r,attrs:{align:"center",width:"190"},scopedSlots:e._u([{key:"header",fn:function(i){return[a("el-button",{attrs:{type:"text"},on:{click:function(t){e.delCol(r)}}},[e._v("删除时段")]),e._v(" "),a("time-picker",{attrs:{time:t.time},on:{"update:time":function(a){e.$set(t,"time",a)}}})]}},{key:"default",fn:function(t){return[a("el-input",{attrs:{size:"mini"},model:{value:t.row.rate[r],callback:function(a){e.$set(t.row.rate,r,a)},expression:"scope.row.rate[colIndex]"}})]}}])})]}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"180",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){e.delRow(t)}}},[e._v("删除奖品")])]}}])})],2)],1),e._v(" "),a("div",{staticStyle:{"margin-top":"15px"}},[a("el-button",{on:{click:e.addCol}},[e._v("添加时段规则")]),e._v(" "),a("el-button",{on:{click:e.addRow}},[e._v("添加奖品")])],1)])],1)},staticRenderFns:[]};var s=a("VU/8")(n,o,!1,function(e){a("WMXI")},"data-v-15df8b37",null);t.default=s.exports},WMXI:function(e,t){}});
//# sourceMappingURL=9.c00f2ef5d9a10210c2cb.js.map