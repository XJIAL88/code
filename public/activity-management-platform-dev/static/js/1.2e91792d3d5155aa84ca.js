webpackJsonp([1],{uKfm:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r("Dd8w"),o=r.n(a),i=r("gyMJ"),c=r("T452"),s=r("0xDb"),u={data:function(){var e=this;return{form:{activityId:"",name:"",categoryId:"",categoryName:"",resourceId:"",resourceNumber:"",awardNumber:"",image:""},rules:{activityId:[{required:!0,message:"请选择活动",trigger:"blur"}],categoryId:[{required:!0,message:"请选择类型",trigger:"blur"}],resourceId:[{required:!0,message:"请选择资源",trigger:"blur"}],resourceNumber:[{required:!0,message:"请输入资源数量",trigger:"blur"},{validator:function(t,r,a){parseFloat(r)>e.totalNumber?a(new Error("资源数量不能大于剩余的资源数量")):parseFloat(r)<.1?a(new Error("资源数量不能小于剩余0.1")):a()},trigger:"blur"}],awardNumber:[{required:!0,message:"请输入奖品数量",trigger:"blur"},{validator:function(t,r,a){parseInt(r)*parseFloat(e.form.resourceNumber)>e.totalNumber?a(new Error("奖品数量不能大于剩余的资源数量除以资源数量")):a()},trigger:"blur"}],name:[{required:!0,message:"请输入奖品名称",trigger:"blur"}],image:[{required:!0,message:"请上传奖品图片",trigger:"blur"}]},activityList:[],resourceList:[],categoryList:[],totalNumber:0,upload:{action:c.a.baseURL+"uploadFileForm?adminId="+Object(s.d)()+"&adminToken="+Object(s.f)(),domain:c.b}}},mounted:function(){this.getActivityList(),this.$nextTick(this.renderBreadCrumbAction)},methods:{renderBreadCrumbAction:function(){var e=this;this.$createElement;this.$bus.$emit("changeBreadCrumbAction",function(t,r){return r("div",{},[r("el-button",{attrs:{size:"medium",type:"primary"},on:{click:e.submitForm}},["确定"]),r("el-button",{attrs:{size:"medium"},on:{click:e.goBack}},["取消"])])})},getActivityList:function(){var e=this;i.a.post("activityGetlist",{status:[2,3,4]}).then(function(t){e.activityList=t.data.dataList,e.$route.query.id&&e.getDetail()})},getDetail:function(){var e=this;i.a.post("activityAwardGet",{id:this.$route.query.id}).then(function(t){e.form=t.data,e.changeActivity(e.form.activityId)})},submitForm:function(){var e=this;this.$refs.form.validate(function(t){if(!t)return!1;e.$route.query.id?i.a.post("activityAwardUpdate",o()({id:e.$route.query.id},e.form)).then(function(t){e.$router.back()}):i.a.post("activityAwardInsert",e.form).then(function(t){e.$router.back()})})},goBack:function(){this.$router.back()},changeActivity:function(e){var t=this;this.activityList.forEach(function(r){r.id==e&&t.activityResourceDetail(r.number)})},activityResourceDetail:function(e){var t=this;i.a.post("activityResourceDetail",{orderNumber:e}).then(function(e){t.resourceList=e.data.dataList,t.categoryList=[];var r=[];e.data.dataList.forEach(function(e){r.indexOf(e.categoryId)<0&&(r.push(e.categoryId),t.categoryList.push({categoryId:e.categoryId,category:e.category}))}),t.$route.query.id&&t.changeResource(t.form.resourceId)})},changeCategory:function(e){var t=this;this.categoryList.forEach(function(r){r.categoryId==e&&(t.form.categoryName=r.category)}),this.form.resourceId=""},changeResource:function(e){var t=this;this.resourceList.forEach(function(r){r.resourceId==e&&(t.totalNumber=r.number)})},handleAvatarSuccess:function(e,t,r){this.form.image=e.data},removeImg:function(){}}},n={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"prize"},[r("el-form",{ref:"form",attrs:{model:e.form,"label-width":"100px",rules:e.rules}},[r("el-row",[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"选择活动",prop:"activityId"}},[r("el-select",{attrs:{placeholder:"请选择",disabled:!!e.$route.query.id},on:{change:e.changeActivity},model:{value:e.form.activityId,callback:function(t){e.$set(e.form,"activityId",t)},expression:"form.activityId"}},e._l(e.activityList,function(e){return r("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),r("el-form-item",{attrs:{label:"选择类型",prop:"categoryId"}},[r("el-select",{attrs:{placeholder:"请选择",disabled:!!e.$route.query.id},on:{change:e.changeCategory},model:{value:e.form.categoryId,callback:function(t){e.$set(e.form,"categoryId",t)},expression:"form.categoryId"}},e._l(e.categoryList,function(e){return r("el-option",{key:e.categoryId,attrs:{label:e.category,value:e.categoryId}})}))],1),e._v(" "),r("el-form-item",{attrs:{label:"选择资源",prop:"resourceId"}},[r("el-select",{attrs:{placeholder:"请选择",disabled:!!e.$route.query.id},on:{change:e.changeResource},model:{value:e.form.resourceId,callback:function(t){e.$set(e.form,"resourceId",t)},expression:"form.resourceId"}},[e._l(e.resourceList,function(t){return[t.categoryId==e.form.categoryId?r("el-option",{key:t.resourceId,attrs:{label:t.resourceName,value:t.resourceId}}):e._e()]})],2)],1),e._v(" "),r("el-form-item",{attrs:{label:"资源数量",prop:"resourceNumber"}},[r("el-input",{attrs:{placeholder:"输入单个该奖品需要的资源数量"},model:{value:e.form.resourceNumber,callback:function(t){e.$set(e.form,"resourceNumber",t)},expression:"form.resourceNumber"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"奖品数量",prop:"awardNumber"}},[r("el-input",{attrs:{placeholder:"输入该奖品的总数"},model:{value:e.form.awardNumber,callback:function(t){e.$set(e.form,"awardNumber",t)},expression:"form.awardNumber"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"奖品名称",prop:"name"}},[r("el-input",{model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"奖品图片",prop:"image"}},[r("el-upload",{staticClass:"avatar-uploader",attrs:{"list-type":"picture-card",data:{fileName:"file",fileType:0},action:e.upload.action,"show-file-list":!1,"on-success":e.handleAvatarSuccess,"on-remove":e.removeImg}},[e.form.image?r("img",{staticClass:"avatar",attrs:{src:e.upload.domain+e.form.image}}):r("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1)],1)],1)],1)],1)},staticRenderFns:[]};var l=r("VU/8")(u,n,!1,function(e){r("xbsI")},"data-v-1d23b8f5",null);t.default=l.exports},xbsI:function(e,t){}});
//# sourceMappingURL=1.2e91792d3d5155aa84ca.js.map